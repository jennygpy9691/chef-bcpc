[DEFAULT]
debug = <%= node['bcpc']['keystone']['debug'] ? 'true' : 'false' %>
log_dir = /var/log/keystone
notification_format = <%= node['bcpc']['keystone']['notification_format'] %>
notification_opt_out = identity.authenticate.success
public_endpoint = https://<%= node["bcpc"]['cloud']["fqdn"]%>:5000/
admin_endpoint = https://<%= node["bcpc"]["cloud"]["fqdn"]%>:35357/

[assignment]
driver = <%= node['bcpc']['keystone']['drivers']['assignment'] %>

[cache]
enabled = <%= node['bcpc']['keystone']['enable_caching'] %>
backend = oslo_cache.memcache_pool
memcache_servers = <%= @headnodes.map{ |h| "#{h['service_ip']}:11211" }.join(',') %>
memcache_dead_retry = 60
memcache_socket_timeout = 1
memcache_pool_connection_get_timeout = 1

[catalog]
driver = <%= node['bcpc']['keystone']['drivers']['catalog'] %>
cache_time = 3600

[credential]
driver = <%= node['bcpc']['keystone']['drivers']['credential'] %>

[database]
connection = mysql+pymysql://<%= @db['username'] %>:<%= @db['password'] %>@<%= @node["bcpc"]["mysql"]["service_hostname"] %>/<%= @db['dbname'] %>
max_overflow = <%= node['bcpc']['keystone']['database']['max_overflow'] %>
max_pool_size = <%= node['bcpc']['keystone']['database']['max_pool_size'] %>

[domain_config]
driver = <%= node['bcpc']['keystone']['drivers']['domain_config'] %>
cache_time = 300

[endpoint_filter]
driver = <%= node['bcpc']['keystone']['drivers']['endpoint_filter'] %>

[endpoint_policy]
driver = <%= node['bcpc']['keystone']['drivers']['endpoint_policy'] %>

[federation]
driver = <%= node['bcpc']['keystone']['drivers']['federation'] %>

[fernet_tokens]
key_repository = /etc/keystone/fernet-keys/
max_active_keys = 3

[identity]
domain_specific_drivers_enabled = true
domain_config_dir = /etc/keystone/domains
cache_time = 600

[identity_mapping]
driver = <%= node['bcpc']['keystone']['drivers']['identity_mapping'] %>

[oauth1]
driver = <%= node['bcpc']['keystone']['drivers']['oauth1'] %>

[oslo_messaging_notifications]
<% if node['bcpc']['keystone']['drivers']['notification'] %>
driver = <%= node['bcpc']['keystone']['drivers']['notification'] %>
<% else %>
driver =
<% end %>

[policy]
driver = <%= node['bcpc']['keystone']['drivers']['policy'] %>

[oslo_policy]
policy_dirs = policy.d

[token]
provider = fernet

[trust]
enabled = true
